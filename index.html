<!DOCTYPE html>
<html>
<head>
    <title>Demo lite - Laurent Savard</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	
	<link rel="stylesheet" href="style2.css">
	
	<!-- Load Esri Leaflet from CDN -->
    <script src="https://unpkg.com/esri-leaflet@2.4.1/dist/esri-leaflet.js"
    integrity="sha512-xY2smLIHKirD03vHKDJ2u4pqeHA7OQZZ27EjtqmuhDguxiUvdsOuXMwkg16PQrm9cgTmXtoxA6kwr8KBy3cdcw=="
    crossorigin=""></script>
	
	<!-- ESRI Geocoder CDN -->
	<script src="https://cdn-geoweb.s3.amazonaws.com/esri-leaflet/0.0.1-beta.5/esri-leaflet.js"></script>
    <script src="https://cdn-geoweb.s3.amazonaws.com/esri-leaflet-geocoder/0.0.1-beta.5/esri-leaflet-geocoder.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn-geoweb.s3.amazonaws.com/esri-leaflet-geocoder/0.0.1-beta.5/esri-leaflet-geocoder.css">  

	<!-- VectorGrid -->
	<script src="https://unpkg.com/leaflet.vectorgrid@latest/dist/Leaflet.VectorGrid.bundled.js"></script>
	<script src="https://unpkg.com/leaflet.vectorgrid@latest/dist/Leaflet.VectorGrid.js"></script>
	
	<!-- DATA -->
	<script src="data/BV_Assomption2.js"></script>
	
	<!-- VectorGrid -->
	<script src="https://unpkg.com/leaflet.vectorgrid@latest/dist/Leaflet.VectorGrid.bundled.js"></script>
	<script src="https://unpkg.com/leaflet.vectorgrid@latest/dist/Leaflet.VectorGrid.js"></script>
	<script src="data/LANO_LAUJS.js"></script>
	<script src="data/RESTE_LANO_LAUR_lightJS.js"></script>
	
	<!-- Geolocation -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>
	
	<!-- Animated icon - Street View -->
    <script src="dependance/L.Icon.Pulse.js"></script>
	<link rel="stylesheet" href="dependance/L.Icon.Pulse.css" />
	
<style>	
body {
    font-family: Arial;
}
.leaflet-top {
    top: 30px;
}
</style>	
	

</head>

<body>

<div class = "BarreHaut">
<div ><span class = "logoHead"></span></div> 
<div ><span style="font-size: 14px;color: white;margin-left: 50px;font-weight: bold;    line-height: 35px;">Demo - Laurent </span><span style="font-size: 10px;color: white;margin-left: 10px;font-weight: bold;    line-height: 35px;">2020-09-29</span></div> 
</div>

<!--Fenêtre d'infobulle item 1  --> 
<div  id = "Info1"class = "Info1ClasseD">
	<p style="text-align:center; font-size: 12px; color:grey; ">MERN 2020. (Sud du Québec)</p>
	</div>
	
<!--Fenêtre d'infobulle item 2  --> 
<div  id = "Info2"class = "Info2ClasseD">
	<p style="text-align:left; font-size: 12px; color:grey; ">CEHQ 2018.</p>
	</div>
	
<!--Fenêtre de Basemap  --> 
<div  id = "InfoBasemap"class = "InfoBasemapClasseD">
    <p style="text-align:center;     border-radius: .2em; font-size: 13px; color:white; background-color:#078BAB ;padding: 5px;margin-top: -3px;margin-right: -3px;margin-left: -3px; " >Fonds de carte</p>
	<p style="text-align:left; font-size: 13px; color:black;    margin-left: 2px; ">Plan :</p>
	<p id = "Basemap4"class = "SelectBasemap"> Gouv. Basemap</p>
	<p id = "Basemap5"class = "SelectBasemap"> CartoDB</p>
	<p id = "Basemap7"class = "SelectBasemap"> Mapbox Outdoors*</p>
	<p id = "Basemap6"class = "SelectBasemapF"> Default (Mapbox Streets)</p>
	<p style="text-align:left; font-size: 13px; color:black;    margin-left: 2px; ">Imagerie :</p>
	<p id = "Basemap1"class = "SelectBasemap"> Esri Imagery</p>
	<p id = "Basemap2"class = "SelectBasemap"> MFFP Imagery</p>
	</div>
	
<!--Fenêtre de Topo  --> 
<div  id = "InfoTopo"class = "InfoTopoClasseD">
    <p style="text-align:center;     border-radius: .2em; font-size: 13px; color:white; background-color:#078BAB ;padding: 5px;margin-top: -3px;margin-right: -3px;margin-left: -3px; "  >Topographie</p>
	<p id = "Basemap3"class = "SelectRecherche">MFFP Relief ombre</p>
	<p id = "Basemap3a"class = "SelectRecherche">MFFP Relief pente</p>
	</div>
	
<!--Fenêtre d'informations  --> 
<div  id = "InfoRecherche"class = "InfoRechercheClasseD">
<p style="text-align:center;     border-radius: .2em; font-size: 13px; color:white; background-color:#078BAB ;padding: 5px;margin-top: -3px;margin-right: -3px;margin-left: -3px; "  >Informations</p>
    <p id = "Recherche1"class = "SelectRecherche">Description de la carte</p>
	<p id = "Recherche2"class = "SelectRecherche">Données utilisées</p>
	<p id = "Recherche3"class = "SelectRecherche">Afficher le cadre administratif</p>
	<p id = "Recherche4"class = "SelectRecherche">Afficher les coordonnées</p>
	<p id = "Recherche5"class = "SelectRecherche">Afficher position dans Google Map</p>
	<p id = "Recherche6"class = "SelectRecherche">Afficher position dans Street view</p>
	</div>

<!--Fenêtre description de la carte  --> 
<div  id = "DescriptionCarte"class = "DescriptionCarteClassD">
<b id = "CloseDesc" >Fermer</b>
	<b style="text-align:left; font-size: 13px;padding: 4px; color:grey; ">Description</b>
	</div>
	
<!--Fenêtre Afficher les coordonnées  --> 
<div  id = "Coordonnees"class = "CoordonneesClassD">
    
    <b style="text-align:left; font-size: 13px;padding: 4px; color:grey; ">Déplacer le curseur</b>
	<p id = "CloseCoor" >Fermer</p>
	<b id = "Recentrer" >Centrer le curseur</b>
	<br />
	<br />
	<div style="text-align:left; font-size: 12px; color:grey; "id = "lat1" class = "box"></div>
	<div style="text-align:left; font-size: 12px; color:grey; "id = "lon1" class = "box"></div>
	</div>
	
<!--Fenêtre Street View  --> 
<div  id = "StreetV"class = "StreetVD">
<b style="display: table;text-align:left; font-size: 11px; color:WHITE;"  >Street View</b>
	<b id = "CloseST" >x</b>
	</div>
	

<!--Fenêtre de la liste des couches  --> 
<div id="fenetre1" class = "fenetre1class">
	<!--Couche 1  -->	
	
	<span id="logo" class = "logoclass"></span>
	<label class="switch">
  <input type="checkbox" id="myCheck" onclick="myFunction()">
  <span class="slider round"></span>
</label>
<b id = "item1" class = "item1debut" >Terre publique</b>
<div class="rectangle1"></div>
	<br />
	<br />
	<!--Couche 2  -->	
	
	<span id="logo2" class = "logo2class"></span>
		<label class="switch">
	 <input type="checkbox" id="myCheck2" onclick="myFunction2()">
  <span class="slider round"></span>
</label>
<b id = "item2" class = "item2debut" >Bassin versant</b>
<div class="rectangle2"></div>
</div>


	<!--Icones widjet  -->
<div style="position: absolute; z-index: 1000; margin: 10px; ">

<div id="B" class = "BarreIcone">
<span id="List" class = "Listclass"></span> </div>
<span id = "ListAdd" class="ListDot"></span>

<div id="B1" class = "BarreIcone1">
<span id="Basemap" class = "Basemapclass"></span> </div>

<div id="B2"  class = "BarreIcone2">
<span id="Topo" class = "Topoclass"></span></div>
<span id = "TopoAdd" class="TopoDot"></span>

<div id="B3" class = "BarreIcone3">
<span id="Loupe" class = "Loupeclass"></span></div>
</div>


<div id = "map"></div>


    <script>
	
        var map = L.map('map',{ zoomControl: false }).setView([47.416115, -73.770760],7);
		
		new L.Control.Zoom({ position: 'topright' }).addTo(map);
		
		//MY LOCATION
		L.control.locate({ position: 'topright'}).addTo(map);

		
		//ERSI SEARCH BAR
        var searchControl = new L.esri.Controls.Geosearch({ position: 'topright',initialZoomLevel: 1 }).addTo(map);
        var results = new L.LayerGroup().addTo(map);

        searchControl.on('results', function(data){
        results.clearLayers();
        for (var i = data.results.length - 1; i >= 0; i--) {
        results.addLayer(L.marker(data.results[i].latlng));
       }
        });
		
		
	////////////////// BASEMAPS //////////////////	
        //Map Panes
        map.createPane('WmsPanes');
        map.getPane('WmsPanes').style.zIndex = 600;
		map.createPane('labels');
        map.getPane('labels').style.zIndex = 650;
		map.createPane('Point');
        map.getPane('Point').style.zIndex = 700;
	
		var CartoDB_Positron = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
	    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
	    subdomains: 'abcd',
	    maxZoom: 20
        });
		
		var esribasemap = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
		attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
		maxZoom: 20
	    });
		
		var wmsLayer5 = L.tileLayer.wms('https://servicesmatriciels.mern.gouv.qc.ca/erdas-iws/ogc/wms/Inventaire_Ecoforestier?', {
        layers: 'Inventaire_Ecoforestier',
		maxZoom: 20
        })
		
		var wmsLayer1 = L.tileLayer.wms('https://geoegl.msp.gouv.qc.ca/ws/mffpecofor.fcgi?', {
        layers: 'lidar_ombre',
		pane: 'WmsPanes'
        })
		
		var wmsLayerPente = L.tileLayer.wms('https://geoegl.msp.gouv.qc.ca/ws/mffpecofor.fcgi?', {
        layers: 'lidar_pentes',
		opacity: 0.4,
		pane: 'WmsPanes'
        })
		
		var MP =L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox/streets-v11',
        tileSize: 512,
        zoomOffset: -1,
        accessToken: 'pk.eyJ1IjoibGF1cmVudHNtYXBib3giLCJhIjoiY2tlY3IxbWVhMDJsOTJwbXEyNXM5M3g3aiJ9.ftdLIT50N3dykY-6KFJsgQ',
		maxZoom: 20
        }).addTo(map);
	
		var MPO =L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		maxZoom: 18,
		id: 'mapbox/outdoors-v11',
		tileSize: 512,
		zoomOffset: -1,
		accessToken: 'pk.eyJ1IjoibGF1cmVudHNtYXBib3giLCJhIjoiY2tlY3IxbWVhMDJsOTJwbXEyNXM5M3g3aiJ9.ftdLIT50N3dykY-6KFJsgQ',
		maxZoom: 20
		});
		
		//Basemap Gouv.Qc
		var wmsLayer11 = L.tileLayer(
        "https://geoegl.msp.gouv.qc.ca/carto/wmts?" +
        "&REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0" +
        "&STYLE=default" + 
        "&TILEMATRIXSET=EPSG_3857" +
        "&FORMAT=image/png"+
        "&LAYER=carte_gouv_qc_public"+
	    "&TILEMATRIX={z}" +
        "&TILEROW={y}" +
        "&TILECOL={x}",
	{
		minZoom : 0,
		maxZoom : 20,
        attribution : "MFFP",
		tileSize : 256 ,
		opacity : 5
	}
    );
		
		
		
	
		
		////////////////// INFOBULLE DES ITEMS DE LA LÉGENDE //////////////////
		
		//Fenêtre Information item1
	    function aa() {
        document.getElementById("Info1").className = "Info1ClasseF";
        };
		document.getElementById("logo").addEventListener("mouseover", aa);
		
		function bb() {
        document.getElementById("Info1").className = "Info1ClasseD";
        };
		document.getElementById("logo").addEventListener("mouseout", bb);
		
		//Fenêtre Information item2
	    function aa2() {
        document.getElementById("Info2").className = "Info2ClasseF";
        };
		document.getElementById("logo2").addEventListener("mouseover", aa2);
		
		function bb2() {
        document.getElementById("Info2").className = "Info2ClasseD";
        };
		document.getElementById("logo2").addEventListener("mouseout", bb2);
		
		////////////////// FENÊTRE DE LA LISTE DES COUCHES //////////////////
		
		//Fenêtre de la liste des couches
	    function openCouche() {
        document.getElementById("fenetre1").className = "fenetre1classF";
		document.getElementById("B").className = "BarreIconeF";
		closeloupe(); //Fermer la loupe
		closetopo(); //Fermer la topo
		close1() ;//Fermer la fenetre de topo
        };
		document.getElementById("B").addEventListener("mouseover", openCouche);
		
		function closeCouche() {
        document.getElementById("fenetre1").className = "fenetre1class";
		document.getElementById("B").className = "BarreIcone";
        };
		//document.getElementById("fenetre1").addEventListener("mouseleave", closeCouche);
		document.getElementById("map").addEventListener("click", closeCouche);
		////////////////// FENÊTRE DES BASEMAP //////////////////

		//Fenêtre de la liste des Basemap
	    function openB() {
        document.getElementById("InfoBasemap").className = "InfoBasemapClasseF";
		document.getElementById("B1").className = "BarreIcone1F";
		closeloupe(); //Fermer la loupe
		closetopo(); //Fermer la fenetre de topo
		closeCouche();
        };
		document.getElementById("B1").addEventListener("mouseover", openB);
		
		
		function close1() {
        document.getElementById("InfoBasemap").className = "InfoBasemapClasseD";
		document.getElementById("B1").className = "BarreIcone1";
        };
		document.getElementById("map").addEventListener("click", close1);

		
		//Selection - Basemap1
	    function B1() {
        document.getElementById("Basemap1").className = "SelectBasemapF";
		esribasemap.addTo(map);
		map.removeLayer(CartoDB_Positron);
		map.removeLayer(wmsLayer5);
		map.removeLayer(wmsLayer11);
		map.removeLayer(MP);
		map.removeLayer(MPO);
			//Enlever la classe de selection au autres basemap
		document.getElementById("Basemap2").className = "SelectBasemap";
		document.getElementById("Basemap4").className = "SelectBasemap";
		document.getElementById("Basemap5").className = "SelectBasemap";
		document.getElementById("Basemap6").className = "SelectBasemap";
		document.getElementById("Basemap7").className = "SelectBasemap";
        };
		document.getElementById("Basemap1").addEventListener("click", B1);
		
		//Selection - Basemap2
	    function B2() {
        document.getElementById("Basemap2").className = "SelectBasemapF";
		wmsLayer5.addTo(map);
		map.removeLayer(CartoDB_Positron);
		map.removeLayer(esribasemap);
		map.removeLayer(wmsLayer11);
		map.removeLayer(MP);
		map.removeLayer(MPO);
			//Enlever la classe de selection au autres basemap
		document.getElementById("Basemap1").className = "SelectBasemap";
		document.getElementById("Basemap4").className = "SelectBasemap";
		document.getElementById("Basemap5").className = "SelectBasemap";
		document.getElementById("Basemap6").className = "SelectBasemap";
		document.getElementById("Basemap7").className = "SelectBasemap";
        };
		document.getElementById("Basemap2").addEventListener("click", B2);
		
		
		//Selection - Basemap4
	    function B4() {
        document.getElementById("Basemap4").className = "SelectBasemapF";
		wmsLayer11.addTo(map);
		map.removeLayer(CartoDB_Positron);
		map.removeLayer(esribasemap);
		map.removeLayer(wmsLayer5);
		map.removeLayer(MP);
		map.removeLayer(MPO);
			//Enlever la classe de selection au autres basemap
		document.getElementById("Basemap2").className = "SelectBasemap";
		document.getElementById("Basemap1").className = "SelectBasemap";
		document.getElementById("Basemap5").className = "SelectBasemap";
		document.getElementById("Basemap6").className = "SelectBasemap";
		document.getElementById("Basemap7").className = "SelectBasemap";
        };
		document.getElementById("Basemap4").addEventListener("click", B4);
		
		//Selection - Basemap5
	    function B5() {
        document.getElementById("Basemap5").className = "SelectBasemapF";
		CartoDB_Positron.addTo(map);
		map.removeLayer(esribasemap);
		map.removeLayer(wmsLayer5);
		map.removeLayer(wmsLayer11);
		map.removeLayer(MP);
		map.removeLayer(MPO);
			//Enlever la classe de selection au autres basemap
		document.getElementById("Basemap1").className = "SelectBasemap";
		document.getElementById("Basemap2").className = "SelectBasemap";
		document.getElementById("Basemap4").className = "SelectBasemap";
		document.getElementById("Basemap6").className = "SelectBasemap";
		document.getElementById("Basemap7").className = "SelectBasemap";
        };
		document.getElementById("Basemap5").addEventListener("click", B5);
		
		//Selection - Basemap6
	    function B6() {
        document.getElementById("Basemap6").className = "SelectBasemapF";
		MP.addTo(map);
		map.removeLayer(esribasemap);
		map.removeLayer(wmsLayer5);
		map.removeLayer(wmsLayer11);
		map.removeLayer(CartoDB_Positron);
		map.removeLayer(MPO);
			//Enlever la classe de selection au autres basemap
		document.getElementById("Basemap1").className = "SelectBasemap";
		document.getElementById("Basemap2").className = "SelectBasemap";
		document.getElementById("Basemap4").className = "SelectBasemap";
		document.getElementById("Basemap5").className = "SelectBasemap";
		document.getElementById("Basemap7").className = "SelectBasemap";
        };
		document.getElementById("Basemap6").addEventListener("click", B6);
		
		//Selection - Basemap7
	    function B7() {
        document.getElementById("Basemap7").className = "SelectBasemapF";
		MPO.addTo(map);
		map.removeLayer(esribasemap);
		map.removeLayer(wmsLayer5);
		map.removeLayer(wmsLayer11);
		map.removeLayer(CartoDB_Positron);
			//Enlever la classe de selection au autres basemap
		document.getElementById("Basemap1").className = "SelectBasemap";
		document.getElementById("Basemap2").className = "SelectBasemap";
		document.getElementById("Basemap4").className = "SelectBasemap";
		document.getElementById("Basemap5").className = "SelectBasemap";
		document.getElementById("Basemap6").className = "SelectBasemap";
        };
		document.getElementById("Basemap7").addEventListener("click", B7);
		
		
		////////////////// FENÊTRE DE TOPO//////////////////
		
		//Fenêtre de la liste des topo
	    function opentopo() {
        document.getElementById("InfoTopo").className = "InfoTopoClasseF";
		document.getElementById("B2").className = "BarreIcone2F";
		closeloupe(); //Fermer la loupe
		close1(); //Fermer la fenetre du basemap
		closeCouche();
        };
		document.getElementById("B2").addEventListener("mouseover", opentopo);
		
		function closetopo() {
        document.getElementById("InfoTopo").className = "InfoTopoClasseD";
		document.getElementById("B2").className = "BarreIcone2";
        };
		document.getElementById("map").addEventListener("click", closetopo);
		
		//Selection - Basemap3
	    function B3() {
		if (map.hasLayer(wmsLayer1)) {
		map.removeLayer(wmsLayer1);
		document.getElementById("Basemap3").className = "SelectRecherche";
		document.getElementById("TopoAdd").className = "TopoDot";
            }
			else{
        document.getElementById("Basemap3").className = "SelectRechercheF";
		wmsLayer1.addTo(map);
		document.getElementById("TopoAdd").className = "TopoDotF";
				//Enlever la classe de selection au autres basemap
        map.removeLayer(wmsLayerPente);
		document.getElementById("Basemap3a").className = "SelectRecherche";}
        };
		document.getElementById("Basemap3").addEventListener("click", B3);
		
		//Selection - Basemap3a
	    function B3aa() {
		if (map.hasLayer(wmsLayerPente)) {
		map.removeLayer(wmsLayerPente);
		document.getElementById("Basemap3a").className = "SelectRecherche";
		document.getElementById("TopoAdd").className = "TopoDot";
            }
			else{
        document.getElementById("Basemap3a").className = "SelectRechercheF";
		wmsLayerPente.addTo(map);
		document.getElementById("TopoAdd").className = "TopoDotF";
			//Enlever la classe de selection au autres basemap
        map.removeLayer(wmsLayer1);
		document.getElementById("Basemap3").className = "SelectRecherche";}
        };
		document.getElementById("Basemap3a").addEventListener("click", B3aa);
		
		
		
		
		
		////////////////// FENÊTRE DU POINT D'INTÉROGATION //////////////////
		
		////Fenêtre du point d'intérogation
	    function openloupe() {
		document.getElementById("InfoRecherche").className = "InfoRechercheClasseF";
		document.getElementById("B3").className = "BarreIcone3F";
		close1(); //Fermer la fenetre du basemap
		closetopo(); //Fermer la fenetre de topo
		closeCouche();
        };
		document.getElementById("B3").addEventListener("mouseover", openloupe);
		
		function closeloupe() {
        document.getElementById("B3").className = "BarreIcone3";
		document.getElementById("InfoRecherche").className = "InfoRechercheClasseD";
        };
		document.getElementById("map").addEventListener("click", closeloupe);
		
		////Selection de la description de la carte
	    function openDesc() {
        document.getElementById("Recherche1").className = "SelectRechercheF";
		document.getElementById("DescriptionCarte").className = "DescriptionCarteClassF";
			//Remmetre par défaut recherche1
		closeCoor();
        };
		document.getElementById("Recherche1").addEventListener("click", openDesc);
		
		function closeDesc() {
        document.getElementById("Recherche1").className = "SelectRecherche";
		document.getElementById("DescriptionCarte").className = "DescriptionCarteClassD";
        };
		document.getElementById("CloseDesc").addEventListener("click", closeDesc);
		
		////Selection de l'affichage des coordonnées
	    function openCoor() {
		 $('#lat1').html("<b  style='text-align:left; color: grey;font-weight: 100;  font-size : 12px'></b>");
		$('#lon1').html("<b  style='text-align:left;color: grey;font-weight: 100;  font-size : 12px'></b>");
		AfficherMarker();
		document.getElementById("Recherche4").className = "SelectRechercheF";
        document.getElementById("Coordonnees").className = "CoordonneesClassF";
			//Remmetre par défaut recherche1
		closeDesc();
        };
		document.getElementById("Recherche4").addEventListener("click", openCoor);
		
		function closeCoor() {
		EnleverMarker();
        document.getElementById("Coordonnees").className = "CoordonneesClassD";
		document.getElementById("Recherche4").className = "SelectRecherche";
        };
		document.getElementById("CloseCoor").addEventListener("click", closeCoor);
		
		// Affichage des coordonnées dans la fenêtre
        var PositionMarker = L.featureGroup();			
        var marker;	
        var lat;
        var lon;
		
        function AfficherMarker() {
		if (map.hasLayer(PositionMarker)) {
        PositionMarker.clearLayers();
		map.removeLayer(PositionMarker);
            }
		var marker = new L.marker(map.getCenter(), {
        draggable: 'true',
		pane: 'Point'
        });
		PositionMarker.addLayer(marker);
		PositionMarker.addTo(map);
		var position = marker.getLatLng();
		// quand l'utilisateur déplace l'icon
		marker.on('drag', function(event) {
        var position = marker.getLatLng();
		var lat = position.lat;
		var lon = position.lng;
		$('#lat1').html("<b  style='text-align:left; color: grey;font-weight: 100;  font-size : 12px'>Latitude : </b>"+lat.toFixed(6));
		$('#lon1').html("<b  style='text-align:left;color: grey;font-weight: 100;  font-size : 12px'>Longitude : </b>"+lon.toFixed(6));
		});
		}
		
        function EnleverMarker() {
		if (map.hasLayer(PositionMarker)) {
        PositionMarker.clearLayers();
		map.removeLayer(PositionMarker);
            }
        };

        // Recentrer le marker
		document.getElementById("Recentrer").addEventListener("click", Center);
        function Center() {
		EnleverMarker();
        AfficherMarker();
        $('#lat1').html("<b  style='text-align:left; color: grey;font-weight: 100;  font-size : 12px'></b>");
		$('#lon1').html("<b  style='text-align:left;color: grey;font-weight: 100;  font-size : 12px'></b>");
        };




        ////////////////////////////////STREETVIEW//////////////////////////////////////

        var featureGroupG = L.featureGroup();
	    var pulsingIcon = L.icon.pulse({iconSize:[14,14],color:'red'});
	
        // cliquer sur le icon de street view
		document.getElementById("Recherche6").addEventListener('click', Google1);
					
        var marker;	
        var lat;
        var lon;
		var win = "";
		
		
        function Google1() {
		// Fermer la fenêtre de streetview si elle existe déjà //
		if (!!win.window) {
        win.window.close();
        }
		var nnn = "nouveau";
        win = "";
        //Selectionner recherche6 
        document.getElementById("Recherche6").className = "SelectRechercheF";		
		//Ouvrir la fenêtre
		document.getElementById("StreetV").className = "StreetVF";
		// Réenitialiser la couche
		if (map.hasLayer(featureGroupG)) {
        featureGroupG.clearLayers();
		map.removeLayer(featureGroupG);
            }
		var marker = new L.marker(map.getCenter(), {
        draggable: 'true',icon: pulsingIcon,pane: 'Point'
        });
		featureGroupG.addLayer(marker);
		featureGroupG.addTo(map);
		var position = marker.getLatLng();
		console.log(position);
		
		// quand l'utilisateur déplace l'icon
		marker.on('dragend', function(event) {
        var position = marker.getLatLng();
		var lat = position.lat;
		var lon = position.lng;
        var url = 'https://www.google.com/maps?layer=c&cbll='+lat+','+lon;
		if (nnn == "nouveau") {
        win = window.open(url, "_blank", "toolbar=yes,scrollbars=yes,resizable=yes,top=570,left=355,width=400,height=400");
		nnn = "";
            }
		else {
		if (!!win.window) {
        //win.window.close();
        }
		//win = window.open(url, "_blank", "toolbar=yes,scrollbars=yes,resizable=yes,top=570,left=355,width=400,height=400");
		win.location.href=(url);
        }
		});
		};
		
        ///**********/// cliquer sur "FERMER" 
		document.getElementById("CloseST").addEventListener("click", Google2);
        //fin
		
        function Google2() {
		if (!!win.window) {
        win.window.close();
        }
		//Ferme la fenêtre
        document.getElementById("StreetV").className = "StreetVD";
		//Enlever la Selection recherche6 
        document.getElementById("Recherche6").className = "SelectRecherche";
		if (map.hasLayer(featureGroupG)) {
        featureGroupG.clearLayers();
		map.removeLayer(featureGroupG);
            }
        };







































	
	////////////////// CHECKBOX //////////////////	
		
	// Item1	
  function myFunction() {
  // Get the checkbox
  var checkBox = document.getElementById("myCheck");
  // If the checkbox is checked, display the output text
  if (checkBox.checked == true){
    TerrePublique.addTo(map);
	document.getElementById("ListAdd").className = "ListDotF";
	//document.getElementById("item1").className = "item1fin";	
  } else {
    map.removeLayer(TerrePublique);
	document.getElementById("ListAdd").className = "ListDot";
	//document.getElementById("item1").className = "item1debut";
  }
}
	
   // Item2	
	function myFunction2() {
  // Get the checkbox
  var checkBox = document.getElementById("myCheck2");
  // If the checkbox is checked, display the output text
  if (checkBox.checked == true){
   bv1.addTo(map);
   document.getElementById("ListAdd").className = "ListDotF";
	//document.getElementById("item2").className = "item2fin";	
  } else {
    map.removeLayer(bv1);
	document.getElementById("ListAdd").className = "ListDot";
	//document.getElementById("item2").className = "item2debut";
  }
}


////////////////// COUCHES DE DONNÉES //////////////////


//BASSIN VERSANT
		// symbologie du bassin versant
		function style(feature) {
        return {
        fillColor: '#ECFB03',
        weight: 1,
        opacity: 1,
        color: 'red',
        dashArray: '3',
        fillOpacity: 0.3
        };
        }

       var data = bv;
       var bv1 = L.geoJson(data ,{
	   style: style,
       onEachFeature: function(feature, featureLayer) {
	   featureLayer.bindPopup(feature.properties.NOM_COURS_);
       }
       });

//TERRES PUBLIQUES 1 - VECTORGRID	



		var highlight;
		var clearHighlight = function() {
			if (highlight) {
				vectorGrid.resetFeatureStyle(highlight);
			}
			highlight = null;
		};
		var vectorGrid = L.vectorGrid.slicer( testvt, {
			rendererFactory: L.svg.tile,
			pane: 'labels',
			  minZoom: 1,
       maxZoom: 18,
			vectorTileLayerStyles: {
				sliced: function(properties, zoom) {
					return {
						fillColor: 'blue',
						fillOpacity: 0.3,
	 					//fillOpacity: 1,
						stroke: true,
						fill: true,
						//color: 'blue',
 							//opacity: 0.2,
						weight: 0,
					}
				}
			},
			interactive: false,
			getFeatureId: function(f) {
				return f.properties.OBJECTID;
			}
		})
		.on('mouseover', function(e) {
			var properties = e.layer.properties;
			L.popup()
				.setContent(properties.CARTE_20K)
				.setLatLng(e.latlng)
				.openOn(map);

			clearHighlight();
			highlight = properties.OBJECTID;

			
			var style = {
				//fillColor: '#800026',
				//fillOpacity: 0.5,
				//fillOpacity: 1,
				//stroke: true,
				//fill: true,
				color: 'red',
				//opacity: 1,
				weight: 4,
			};

			vectorGrid.setFeatureStyle(properties.OBJECTID, style);
		});

		map.on('click', clearHighlight);
		
		
//TERRES PUBLIQUES (RESTE) - VECTORGRID	
		var highlight;
		var clearHighlight = function() {
			if (highlight) {
				vectorGrid.resetFeatureStyle(highlight);
			}
			highlight = null;
		};
		var vectorGrid2 = L.vectorGrid.slicer( testvt1, {
			rendererFactory: L.svg.tile,
			pane: 'labels',
			  minZoom: 1,
       maxZoom: 18,
			vectorTileLayerStyles: {
				sliced: function(properties, zoom) {
					return {
						fillColor: 'blue',
						fillOpacity: 0.3,
	 					//fillOpacity: 1,
						stroke: true,
						fill: true,
						//color: 'blue',
 							//opacity: 0.2,
						weight: 0,
					}
				}
			},
			interactive: false,
			getFeatureId: function(f) {
				return f.properties.OBJECTID;
			}
		})
		.on('mouseover', function(e) {
			var properties = e.layer.properties;
			L.popup()
				.setContent(properties.CARTE_20K)
				.setLatLng(e.latlng)
				.openOn(map);

			clearHighlight();
			highlight = properties.OBJECTID;

			
			var style = {
				//fillColor: '#800026',
				//fillOpacity: 0.5,
				//fillOpacity: 1,
				//stroke: true,
				//fill: true,
				color: 'red',
				//opacity: 1,
				weight: 4,
			};

			vectorGrid.setFeatureStyle(properties.OBJECTID, style);
		});

		map.on('click', clearHighlight);
		
		var TerrePublique = L.featureGroup([vectorGrid, vectorGrid2]);
		
	


		
		
		
		
		
		
    </script>
</body>
</html>
